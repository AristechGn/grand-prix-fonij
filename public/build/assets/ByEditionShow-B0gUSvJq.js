import{r as p,j as e,B as ge,W as he,b as pe}from"./app-DvwYORMh.js";import{A as ue}from"./app-layout-nW5gPRKY.js";import{F as I,D as fe}from"./data-table-BMyDh0vN.js";import{B as i}from"./button-CQQlbXvm.js";import{C as f,a as b,b as K,c as O,d as H}from"./card-mcPbQmcC.js";import{I as $}from"./input-C_j_ys4p.js";import{B as E}from"./badge-C94mvrLn.js";import{D as be,a as je,b as Ne,c as we,d as ye,e as ve}from"./dialog-BKFUb_Zc.js";import{S as q,a as W,b as J,c as X,d as N}from"./select-wrnrkMaR.js";import{F as Se}from"./index-CwCyH5_Z.js";import{A as Ce}from"./arrow-left-BdMN-Lre.js";import{C as G}from"./calendar-B-VGunfp.js";import{D as Q}from"./download-Cx-ovCym.js";import{F as _e}from"./index-Dmzhg338.js";import{U as Y}from"./users-C3_tBJjS.js";import{F as Z}from"./filter-B5RbTYTL.js";import{S as ke}from"./search-C_6AeMJh.js";import{X as w}from"./x-XWWRALWT.js";import{T as P}from"./trash-Be3sDCVd.js";import{E as De}from"./eye-Bn1Vixyh.js";import{S as Fe}from"./square-pen-7O0MjyKO.js";import"./index-XYEWX3qu.js";import"./index-CN9p1dlp.js";import"./index-DYj5555m.js";import"./createLucideIcon-B2K1Nsdj.js";import"./app-logo-icon-BL9Om477.js";import"./table-CloQ0MmV.js";import"./chevron-left-BbrTzO05.js";import"./index-CYMY4nmV.js";import"./check-DGVItuFN.js";import"./trophy-BZmxCVvj.js";function is({edition:x,applications:n,statuses:y,categories:v,filters:t}){var B,U,V;const[o,S]=p.useState(t.search||""),[r,C]=p.useState(t.status||"all"),[l,_]=p.useState(((B=t.category)==null?void 0:B.toString())||"all"),[c,R]=p.useState(t.score_min||""),[d,A]=p.useState(t.score_max||""),[h,k]=p.useState([]),[ee,j]=p.useState(!1),[m,D]=p.useState(null),se=s=>{k(a=>a.includes(s)?a.filter(g=>g!==s):[...a,s])},ae=()=>{h.length===n.data.length?k([]):k(n.data.map(s=>s.id))};console.log("Categories reçues:",v),console.log("Types des catégories:",v.map(s=>typeof s));const T=v.map(s=>typeof s=="string"?parseInt(s,10):s).filter(s=>s!=null&&!isNaN(s)&&s>0&&s<=5);console.log("Catégories nettoyées:",T);const te=()=>{const s=new URLSearchParams;o&&s.append("search",o),r&&r!=="all"&&s.append("status",r),l&&l!=="all"&&s.append("category",l),c&&s.append("score_min",c.toString()),d&&s.append("score_max",d.toString()),t.per_page&&s.append("per_page",t.per_page.toString()),window.location.href=`${route("admin.applications.by-edition.show",x.id)}?${s.toString()}`},re=()=>{S(""),C("all"),_("all"),R(""),A(""),window.location.href=route("admin.applications.by-edition.show",x.id)},F=s=>n.data.filter(a=>a.status===s).length,u=s=>{const a=typeof s=="string"?parseInt(s,10):s;return!a||a<=0||a>5||isNaN(a)?null:Se.categories.find(xe=>xe.id===a)||null},z=s=>{const a=u(s),g=typeof s=="string"?parseInt(s,10):s;return a?a.title:`Catégorie ${g}`},le=[{id:"select",header:()=>e.jsx("input",{type:"checkbox",checked:h.length===n.data.length&&n.data.length>0,onChange:ae,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),cell:({row:s})=>e.jsx("input",{type:"checkbox",checked:h.includes(s.original.id),onChange:()=>se(s.original.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),enableSorting:!1,enableHiding:!1},{header:"Référence",accessorKey:"application_number",cell:({row:s})=>e.jsx("a",{href:route("admin.applications.show",s.original.id),className:"font-mono text-blue-600 hover:underline",children:s.getValue("application_number")})},{header:"Candidat",accessorFn:s=>`${s.first_name} ${s.last_name}`},{header:"Projet",accessorKey:"project_name"},{header:"Catégorie",accessorKey:"category",cell:({row:s})=>{const a=u(s.original.category);return a?e.jsxs("div",{className:"max-w-[200px]",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",title:a.title,children:a.title}),e.jsx("div",{className:"text-xs text-gray-500 truncate",title:a.description,children:a.description})]}):e.jsx("div",{className:"max-w-[200px]",children:e.jsxs("span",{className:"text-sm text-gray-500 font-medium",children:["Catégorie ",s.original.category]})})}},{header:"Statut",accessorKey:"status",cell:({row:s})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ne(s.original.status)}`,children:y[s.original.status]})},{header:"Score",accessorKey:"score",cell:({row:s})=>e.jsx("span",{className:"font-mono",children:s.original.score?`${s.original.score}/100`:"-"})},{header:"Date",accessorKey:"submitted_at",cell:({row:s})=>new Date(s.original.submitted_at).toLocaleDateString("fr-FR")},{header:"Actions",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>window.location.href=route("admin.applications.show",s.original.id),className:"hover:bg-blue-50 hover:border-blue-300 transition-colors",title:"Voir les détails",children:e.jsx(De,{className:"h-4 w-4 text-blue-600"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>window.location.href=route("admin.applications.edit",s.original.id),className:"hover:bg-green-50 hover:border-green-300 transition-colors",title:"Modifier",children:e.jsx(Fe,{className:"h-4 w-4 text-green-600"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ie(s.original),className:"hover:bg-red-50 hover:border-red-300 transition-colors",title:"Supprimer",children:e.jsx(P,{className:"h-4 w-4 text-red-600"})})]})}],ne=s=>({pending:"bg-yellow-100 text-yellow-800",validated:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",selected:"bg-blue-100 text-blue-800",finalist:"bg-purple-100 text-purple-800",winner:"bg-indigo-100 text-indigo-800"})[s]||"bg-gray-100 text-gray-800",L=()=>{const s=new URLSearchParams;s.append("edition_id",x.id.toString()),o&&s.append("search",o),r&&r!=="all"&&s.append("status",r),l&&l!=="all"&&s.append("category",l),c&&s.append("score_min",c.toString()),d&&s.append("score_max",d.toString()),window.open(`${route("admin.applications.export")}?${s.toString()}`,"_blank")},M=()=>{if(h.length===0){alert("Veuillez sélectionner au moins une candidature à exporter.");return}const s=new URLSearchParams;s.append("edition_id",x.id.toString()),h.forEach(a=>{s.append("application_ids[]",a.toString())}),o&&s.append("search",o),r&&r!=="all"&&s.append("status",r),l&&l!=="all"&&s.append("category",l),c&&s.append("score_min",c.toString()),d&&s.append("score_max",d.toString()),window.location.href=`${route("admin.applications.export-folders")}?${s.toString()}`},ie=s=>{D(s),j(!0)},oe=()=>{m&&pe.delete(route("admin.applications.destroy",m.id),{onSuccess:()=>{j(!1),D(null)},onError:s=>{console.error("Erreur lors de la suppression:",s)}})},ce=()=>{j(!1),D(null)},de=s=>{const a=new URLSearchParams;o&&a.append("search",o),r&&r!=="all"&&a.append("status",r),l&&l!=="all"&&a.append("category",l),c&&a.append("score_min",c.toString()),d&&a.append("score_max",d.toString()),t.per_page&&a.append("per_page",t.per_page.toString()),a.append("page",s.toString()),window.location.href=`${route("admin.applications.by-edition.show",x.id)}?${a.toString()}`},me=s=>{const a=new URLSearchParams;o&&a.append("search",o),r&&r!=="all"&&a.append("status",r),l&&l!=="all"&&a.append("category",l),c&&a.append("score_min",c.toString()),d&&a.append("score_max",d.toString()),a.append("per_page",s.toString()),window.location.href=`${route("admin.applications.by-edition.show",x.id)}?${a.toString()}`};return e.jsxs(ue,{children:[e.jsx(ge,{title:`Candidatures - ${x.name}`}),e.jsx("div",{className:"py-8 overflow-x-hidden",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 w-full space-y-6 overflow-x-hidden",children:[e.jsx("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(he,{href:route("admin.applications.by-edition"),children:e.jsxs(i,{variant:"outline",size:"sm",className:"bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-blue-600"}),"Retour"]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-extrabold text-gray-900 flex items-center gap-2 sm:gap-4",children:[e.jsx(G,{className:"h-8 w-8 sm:h-10 sm:w-10 text-blue-600 bg-white rounded-full p-2 shadow-md flex-shrink-0"}),e.jsx("span",{className:"truncate",children:x.name})]}),e.jsxs("p",{className:"text-gray-600 mt-2 text-sm sm:text-lg break-words",children:["Édition ",x.year," - ",n.total," candidature",n.total>1?"s":""]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full lg:w-auto",children:[e.jsxs(i,{onClick:L,className:"bg-green-500 hover:bg-green-600 text-white transition-colors shadow-md",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Exporter Excel"]}),e.jsxs(i,{onClick:M,className:"bg-blue-500 hover:bg-blue-600 text-white transition-colors shadow-md",disabled:h.length===0,children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Exporter Dossiers (",h.length,")"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(f,{className:"hover:shadow-lg transition-shadow",children:e.jsx(b,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-blue-200 flex items-center justify-center mr-5 shadow-md",children:e.jsx(_e,{className:"h-7 w-7 text-blue-700"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold",children:"Total candidatures"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:n.total})]})]})})}),e.jsx(f,{className:"hover:shadow-lg transition-shadow",children:e.jsx(b,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-green-200 flex items-center justify-center mr-5 shadow-md",children:e.jsx(Y,{className:"h-7 w-7 text-green-700"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold",children:"Validées"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:F("validated")})]})]})})}),e.jsx(f,{className:"hover:shadow-lg transition-shadow",children:e.jsx(b,{className:"p-6 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-yellow-200 flex items-center justify-center mr-5 shadow-md",children:e.jsx(G,{className:"h-7 w-7 text-yellow-700"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold",children:"En attente"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-900",children:F("pending")})]})]})})}),e.jsx(f,{className:"hover:shadow-lg transition-shadow",children:e.jsx(b,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-purple-200 flex items-center justify-center mr-5 shadow-md",children:e.jsx(Y,{className:"h-7 w-7 text-purple-700"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold",children:"Finalistes"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:F("finalist")})]})]})})})]}),e.jsxs(f,{className:"mb-6 bg-gradient-to-br from-gray-50 to-gray-100 shadow-lg",children:[e.jsxs(K,{className:"bg-white/50 backdrop-blur-sm rounded-t-lg border-b border-gray-200",children:[e.jsxs(O,{className:"flex items-center gap-3 text-xl font-bold text-gray-800",children:[e.jsx(Z,{className:"h-6 w-6 text-blue-600"}),"Filtres de recherche"]}),e.jsx(H,{className:"text-gray-600",children:"Affinez votre recherche avec des filtres précis"})]}),e.jsxs(b,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recherche"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx($,{placeholder:"Nom, projet, email...",className:"pl-10 bg-white border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all w-full",value:o,onChange:s=>S(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Statut"}),e.jsxs(q,{value:r,onValueChange:C,children:[e.jsx(W,{className:"bg-white border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all",children:e.jsx(J,{placeholder:"Tous les statuts"})}),e.jsxs(X,{className:"bg-white shadow-lg rounded-lg",children:[e.jsx(N,{value:"all",className:"hover:bg-gray-100 transition-colors",children:"Tous les statuts"}),Object.entries(y).map(([s,a])=>e.jsx(N,{value:s,className:"hover:bg-gray-100 transition-colors",children:a},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catégorie"}),e.jsxs(q,{value:l,onValueChange:_,children:[e.jsx(W,{className:"bg-white border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all",children:e.jsx(J,{placeholder:"Toutes les catégories"})}),e.jsxs(X,{className:"bg-white shadow-lg rounded-lg",children:[e.jsx(N,{value:"all",className:"hover:bg-gray-100 transition-colors",children:"Toutes les catégories"}),T.map(s=>{const a=Number(s),g=u(a);return e.jsx(N,{value:a.toString(),className:"hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:(g==null?void 0:g.title)||`Catégorie ${a}`}),g&&e.jsx("span",{className:"text-xs text-gray-500 truncate max-w-[200px]",children:g.description})]})},a)})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Score"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"number",placeholder:"Min",min:"0",max:"100",value:c,onChange:s=>R(s.target.value),className:"w-20 bg-white border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all"}),e.jsx("span",{className:"flex items-center text-gray-500",children:"-"}),e.jsx($,{type:"number",placeholder:"Max",min:"0",max:"100",value:d,onChange:s=>A(s.target.value),className:"w-20 bg-white border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mt-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(i,{onClick:te,className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors shadow-md",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Appliquer les filtres"]}),e.jsxs(i,{variant:"outline",onClick:re,className:"border-gray-300 hover:bg-gray-100 transition-colors",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Réinitialiser"]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap min-w-0",children:[t.search&&e.jsxs(E,{variant:"secondary",className:"flex items-center gap-1 bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors max-w-full",children:[e.jsxs("span",{className:"truncate",children:["Recherche: ",t.search]}),e.jsx(w,{className:"h-3 w-3 cursor-pointer text-blue-600 hover:text-blue-800 flex-shrink-0",onClick:()=>S("")})]}),t.status&&e.jsxs(E,{variant:"secondary",className:"flex items-center gap-1 bg-green-100 text-green-800 hover:bg-green-200 transition-colors max-w-full",children:[e.jsxs("span",{className:"truncate",children:["Statut: ",y[t.status]]}),e.jsx(w,{className:"h-3 w-3 cursor-pointer text-green-600 hover:text-green-800 flex-shrink-0",onClick:()=>C("all")})]}),t.category&&e.jsxs(E,{variant:"secondary",className:"flex items-center gap-1 bg-purple-100 text-purple-800 hover:bg-purple-200 transition-colors max-w-full",children:[e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsxs("span",{className:"font-medium truncate",children:["Catégorie: ",z(t.category)]}),u(t.category)&&e.jsx("span",{className:"text-xs opacity-75 truncate max-w-[150px]",children:(U=u(t.category))==null?void 0:U.description})]}),e.jsx(w,{className:"h-3 w-3 cursor-pointer text-purple-600 hover:text-purple-800 flex-shrink-0",onClick:()=>_("all")})]})]})]})]})]}),e.jsxs(f,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs(O,{className:"break-words",children:["Candidatures de l'édition ",x.name,t.category&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["- Catégorie: ",z(t.category)]})]}),e.jsxs(H,{className:"break-words",children:["Liste des candidatures soumises pour cette édition",t.category&&e.jsx("span",{className:"block text-xs text-gray-500 mt-1 break-words",children:(V=u(t.category))==null?void 0:V.description})]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs(i,{onClick:L,variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Excel"]}),e.jsxs(i,{onClick:M,variant:"outline",size:"sm",disabled:h.length===0,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Dossiers (",h.length,")"]})]})]})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsx(fe,{columns:le,data:n.data,pagination:{pageIndex:n.current_page-1,pageSize:n.per_page,pageCount:n.last_page,total:n.total},onPageChange:de,onItemsPerPageChange:me,itemsPerPageOptions:[10,25,50,70,80,100]})})})]})]})}),e.jsx(be,{open:ee,onOpenChange:j,children:e.jsxs(je,{className:"max-w-md",children:[e.jsxs(Ne,{children:[e.jsxs(we,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Confirmer la suppression"]}),e.jsxs(ye,{className:"text-gray-600",children:["Êtes-vous sûr de vouloir supprimer la candidature de"," ",e.jsxs("span",{className:"font-semibold text-gray-900",children:[m==null?void 0:m.first_name," ",m==null?void 0:m.last_name]})," ","pour le projet"," ",e.jsxs("span",{className:"font-semibold text-gray-900",children:['"',m==null?void 0:m.project_name,'"']}),"?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-red-600 font-medium",children:"Cette action est irréversible et supprimera définitivement tous les fichiers associés."})]})]}),e.jsxs(ve,{className:"gap-2",children:[e.jsx(i,{variant:"outline",onClick:ce,className:"border-gray-300 hover:bg-gray-100 transition-colors",children:"Annuler"}),e.jsxs(i,{onClick:oe,className:"bg-red-600 hover:bg-red-700 text-white transition-colors",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Supprimer définitivement"]})]})]})})]})}export{is as default};
